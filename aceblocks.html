<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AceBlocks MAX | Roblox Block Engine & Lessons</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Montserrat', sans-serif; background:#0f172a; color:white; margin:0; padding:0; display:flex; height:100vh; overflow:hidden; }
h1, h2, h3 { margin:0; }
#sidebar { width:280px; background:#111827; padding:20px; overflow-y:auto; box-shadow:2px 0 10px rgba(0,0,0,0.5); }
#workspace-container { flex:1; display:flex; flex-direction:column; padding:20px; overflow:auto; }
.category { margin-bottom:15px; }
.category h2 { cursor:pointer; background:#1e293b; padding:5px 10px; border-radius:8px; margin:0; font-size:1rem; display:flex; justify-content:space-between; align-items:center; }
.category h2 span { transform:rotate(90deg); display:inline-block; transition:0.3s; }
.category.collapsed h2 span { transform:rotate(0deg); }
.block-list { margin-top:5px; display:flex; flex-direction:column; gap:5px; }
.block { padding:10px; border-radius:10px; cursor:grab; font-weight:bold; color:white; transition:0.2s; text-align:center; }
.block:hover { transform:scale(1.05); }
.Player{background:#2563eb;} .Action{background:#f59e0b;} .Print{background:#10b981;} 
.Loop{background:#8b5cf6;} .Teleport{background:#ef4444;} .Event{background:#f43f5e;}
#workspace { flex:1; margin-top:10px; background:#111827; padding:20px; border-radius:12px; min-height:300px; text-align:left; position:relative; overflow:auto; }
.workspace-block{border-radius:8px; padding:10px; margin-bottom:5px; display:flex; align-items:center; cursor:grab; position:relative; transition:0.2s; background:#1e293b; }
.workspace-block input{width:70px; margin-left:5px; border-radius:4px; border:none; padding:2px 5px;}
.nested{margin-left:20px; border-left:2px dashed #38bdf8; padding-left:10px;}
.delete-btn{background:red;color:white;border:none;border-radius:4px;margin-left:10px;cursor:pointer;padding:2px 5px;}
#codeOutput{margin-top:20px;background:#0f172a;color:#38bdf8;padding:15px;border-radius:12px;font-family:monospace;white-space:pre-wrap;text-align:left; max-width:100%; }
.button{display:inline-block;padding:10px 20px;margin:10px 5px 0 0;background:#38bdf8;color:#0f172a;text-decoration:none;border-radius:8px;font-weight:700;transition:0.3s ease;}
.button:hover{background:white;}
#character { width:80px; height:80px; background:#facc15; border-radius:50%; position:absolute; bottom:10px; left:10px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#0f172a; }
#lessonMenu { margin-bottom:15px; }
.lesson-button { padding:8px 15px; margin:5px 0; background:#38bdf8; border:none; border-radius:6px; color:#0f172a; cursor:pointer; font-weight:700; width:100%; text-align:left; }
.lesson-button:hover { background:#0ea5e9; }
#objective { margin-top:10px; padding:10px; background:#1e293b; border-radius:8px; }
#certificate { display:none; padding:20px; background:#10b981; color:#0f172a; font-weight:bold; border-radius:12px; margin-top:20px; text-align:center; }
</style>
</head>
<body>

<div id="sidebar">
  <h1>AceBlocks MAX</h1>

  <div id="lessonMenu">
    <h2>Lessons</h2>
    <div id="lessonButtons"></div>
  </div>

  <div class="category" id="eventsCategory">
    <h2>Events <span>â–¶</span></h2>
    <div class="block-list">
      <div class="block Event" draggable="true" data-type="OnPlayerJoin">On Player Join</div>
      <div class="block Event" draggable="true" data-type="OnKeyPress">On Key Press</div>
      <div class="block Event" draggable="true" data-type="OnTouch">On Touch</div>
      <div class="block Event" draggable="true" data-type="OnClick">On Click</div>
      <div class="block Event" draggable="true" data-type="OnDeath">On Death</div>
    </div>
  </div>

  <div class="category" id="playerCategory">
    <h2>Player <span>â–¶</span></h2>
    <div class="block-list">
      <div class="block Player" draggable="true" data-type="WalkSpeed">WalkSpeed</div>
      <div class="block Player" draggable="true" data-type="JumpPower">JumpPower</div>
      <div class="block Player" draggable="true" data-type="Stamina">Stamina</div>
    </div>
  </div>

  <div class="category" id="actionsCategory">
    <h2>Actions <span>â–¶</span></h2>
    <div class="block-list">
      <div class="block Action" draggable="true" data-type="Say">Say Message</div>
      <div class="block Action" draggable="true" data-type="Teleport">Teleport</div>
      <div class="block Action" draggable="true" data-type="PlaySound">Play Sound</div>
      <div class="block Action" draggable="true" data-type="SpawnItem">Spawn Item</div>
      <div class="block Action" draggable="true" data-type="ChangeHealth">Change Health</div>
      <div class="block Action" draggable="true" data-type="MessageAll">Message All</div>
    </div>
  </div>

  <div class="category" id="logicCategory">
    <h2>Logic <span>â–¶</span></h2>
    <div class="block-list">
      <div class="block Loop" draggable="true" data-type="Loop">Loop</div>
      <div class="block Loop" draggable="true" data-type="While">While</div>
      <div class="block Loop" draggable="true" data-type="If">If</div>
      <div class="block Loop" draggable="true" data-type="IfElse">If Else</div>
    </div>
  </div>

  <div class="category" id="printCategory">
    <h2>Print <span>â–¶</span></h2>
    <div class="block-list">
      <div class="block Print" draggable="true" data-type="Print">Print Text</div>
    </div>
  </div>
</div>

<div id="workspace-container">
  <div id="objective">Complete a lesson to see your objective!</div>
  <div id="workspace">Workspace: Drop blocks here</div>
  <div id="character">ðŸ™‚</div>
  <h3>Generated Lua Code:</h3>
  <div id="codeOutput">-- Lua code will appear here</div>
  <a href="#" class="button" id="exportBtn">Export Lua</a>
  <a href="#" class="button" id="saveBtn">Save Workspace</a>
  <a href="#" class="button" id="loadBtn">Load Workspace</a>
  <div id="certificate">ðŸŽ‰ Congratulations! You completed all lessons! ðŸŽ‰</div>
</div>

<script>
// ----- Setup lessons -----
const lessons = [
  {id:1,name:"Lesson 1: Print Hello",objective:"Use a Print block to display 'Hello Roblox'",blocks:["Print"]},
  {id:2,name:"Lesson 2: Player Speed",objective:"Set Player WalkSpeed to 50",blocks:["WalkSpeed"]},
  {id:3,name:"Lesson 3: Jump Power",objective:"Set Player JumpPower to 100",blocks:["JumpPower"]},
  {id:4,name:"Lesson 4: Say Message",objective:"Make the player say 'Hi!'",blocks:["Say"]},
  {id:5,name:"Lesson 5: Loop Print",objective:"Use a Loop to print 5 times",blocks:["Loop","Print"]},
  {id:6,name:"Lesson 6: If Statement",objective:"Print only if a condition is true",blocks:["If","Print"]},
  {id:7,name:"Lesson 7: If Else",objective:"Use If Else to choose between two prints",blocks:["IfElse","Print"]},
  {id:8,name:"Lesson 8: On Key Press",objective:"Use OnKeyPress event for 'E' key",blocks:["OnKeyPress","Print"]},
  {id:9,name:"Lesson 9: On Player Join",objective:"Use OnPlayerJoin to greet new player",blocks:["OnPlayerJoin","Print"]},
  {id:10,name:"Lesson 10: Teleport",objective:"Teleport the player to x,y,z",blocks:["Teleport"]},
  {id:11,name:"Lesson 11: Change Health",objective:"Change player's health to 50",blocks:["ChangeHealth"]},
  {id:12,name:"Lesson 12: Message All",objective:"Send a message to all players",blocks:["MessageAll"]}
];

const lessonButtonsDiv=document.getElementById('lessonButtons');
let currentLesson=null;

// Create buttons for lessons
lessons.forEach(lesson=>{
  const btn=document.createElement('button');
  btn.textContent=lesson.name;
  btn.className="lesson-button";
  btn.onclick=()=>startLesson(lesson.id);
  lessonButtonsDiv.appendChild(btn);
});

// ----- Category collapse -----
document.querySelectorAll('.category h2').forEach(h2=>{
  h2.addEventListener('click',()=>{
    h2.parentElement.classList.toggle('collapsed');
    h2.nextElementSibling.style.display=h2.parentElement.classList.contains('collapsed')?'none':'flex';
  });
  h2.nextElementSibling.style.display='flex';
});

// ----- Drag & drop blocks -----
document.querySelectorAll('.block').forEach(block=>{
  block.addEventListener('dragstart',e=>{
    e.dataTransfer.setData('text/plain', block.dataset.type);
  });
});
const workspace=document.getElementById('workspace');
workspace.addEventListener('dragover',e=>e.preventDefault());
workspace.addEventListener('drop',e=>{
  e.preventDefault();
  const type=e.dataTransfer.getData('text/plain');
  addBlockToWorkspace(type,workspace);
});

// ----- Add block to workspace -----
function addBlockToWorkspace(type,parent){
  const blockEl=document.createElement('div');
  blockEl.className='workspace-block';
  blockEl.dataset.type=type;
  let html='';
  switch(type){
    case 'WalkSpeed': html='WalkSpeed=<input type="number" value="24">'; break;
    case 'JumpPower': html='JumpPower=<input type="number" value="50">'; break;
    case 'Stamina': html='Stamina=<input type="number" value="100">'; break;
    case 'Print': html='print(<input type="text" value="Hello Roblox">)'; break;
    case 'Say': html='Say(<input type="text" value="Hi!">)'; break;
    case 'Teleport': html='Teleport to <input type="text" value="x,y,z">'; break;
    case 'PlaySound': html='PlaySound(<input type="text" value="SoundID">)'; break;
    case 'SpawnItem': html='SpawnItem(<input type="text" value="ItemName">)'; break;
    case 'ChangeHealth': html='ChangeHealth(<input type="number" value="10">)'; break;
    case 'MessageAll': html='MessageAll(<input type="text" value="Hello Everyone">)'; break;
    case 'Loop': html='Loop <input type="number" value="5"> times <div class="nested"></div>'; break;
    case 'While': html='While <input type="text" value="condition"> do <div class="nested"></div>'; break;
    case 'If': html='If <input type="text" value="condition"> then <div class="nested"></div>'; break;
    case 'IfElse': html='If <input type="text" value="condition"> then <div class="nested"></div> else <div class="nested"></div>'; break;
    case 'OnPlayerJoin': html='OnPlayerJoin <div class="nested"></div>'; break;
    case 'OnKeyPress': html='OnKeyPress key <input type="text" value="E"> <div class="nested"></div>'; break;
    case 'OnTouch': html='OnTouch <div class="nested"></div>'; break;
    case 'OnClick': html='OnClick <div class="nested"></div>'; break;
    case 'OnDeath': html='OnDeath <div class="nested"></div>'; break;
  }
  blockEl.innerHTML=html;
  const del=document.createElement('button');
  del.textContent='X';
  del.className='delete-btn';
  del.onclick=()=>{ blockEl.remove(); updateCode(); checkObjective(); };
  blockEl.appendChild(del);
  parent.appendChild(blockEl);

  blockEl.querySelectorAll('.nested').forEach(nested=>{
    nested.addEventListener('dragover', e=>e.preventDefault());
    nested.addEventListener('drop', e=>{
      e.preventDefault();
      const nestedType=e.dataTransfer.getData('text/plain');
      addBlockToWorkspace(nestedType,nested);
    });
  });
  blockEl.querySelectorAll('input').forEach(inp=>inp.addEventListener('input', ()=>{ updateCode(); checkObjective(); }));
  updateCode();
  checkObjective();
}

// ----- Generate Lua code -----
function generateLua(blocks,indent=''){
  let lua='';
  blocks.forEach(b=>{
    const type=b.dataset.type;
    const input=b.querySelector('input');
    switch(type){
      case 'WalkSpeed': lua+=`${indent}Player.WalkSpeed=${input.value}\n`; break;
      case 'JumpPower': lua+=`${indent}Player.JumpPower=${input.value}\n`; break;
      case 'Stamina': lua+=`${indent}Player.Stamina=${input.value}\n`; break;
      case 'Print': lua+=`${indent}print("${input.value}")\n`; break;
      case 'Say': lua+=`${indent}Player:Say("${input.value}")\n`; break;
      case 'Teleport': lua+=`${indent}Player:Teleport(Vector3.new(${input.value}))\n`; break;
      case 'PlaySound': lua+=`${indent}PlaySound("${input.value}")\n`; break;
      case 'SpawnItem': lua+=`${indent}SpawnItem("${input.value}")\n`; break;
      case 'ChangeHealth': lua+=`${indent}ChangeHealth(${input.value})\n`; break;
      case 'MessageAll': lua+=`${indent}MessageAll("${input.value}")\n`; break;
      case 'Loop':
        lua+=`${indent}for i=1,${input.value} do\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end\n`; break;
      case 'While':
        lua+=`${indent}while ${input.value} do\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end\n`; break;
      case 'If':
        lua+=`${indent}if ${input.value} then\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end\n`; break;
      case 'IfElse':
        const children=b.querySelectorAll('.nested');
        lua+=`${indent}if ${input.value} then\n`;
        lua+=generateLua(Array.from(children[0].children),indent+'  ');
        lua+=`${indent}else\n`;
        lua+=generateLua(Array.from(children[1].children),indent+'  ');
        lua+=`${indent}end\n`; break;
      case 'OnPlayerJoin':
        lua+=`${indent}game.Players.PlayerAdded:Connect(function(player)\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end)\n`; break;
      case 'OnKeyPress':
        lua+=`${indent}game:GetService("UserInputService").InputBegan:Connect(function(input,processed)\n`;
        lua+=`${indent}  if input.KeyCode==Enum.KeyCode.${input.value} then\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'    ');
        lua+=`${indent}  end\n${indent}end)\n`; break;
      case 'OnTouch':
        lua+=`${indent}part.Touched:Connect(function(hit)\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end)\n`; break;
      case 'OnClick':
        lua+=`${indent}clickDetector.MouseClick:Connect(function(player)\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end)\n`; break;
      case 'OnDeath':
        lua+=`${indent}player.Character.Humanoid.Died:Connect(function()\n`;
        lua+=generateLua(Array.from(b.querySelector('.nested').children),indent+'  ');
        lua+=`${indent}end)\n`; break;
    }
  });
  return lua;
}

function updateCode(){ codeOutput.textContent=generateLua(Array.from(workspace.children))||'-- Lua code will appear here'; }

// ----- Export / Save / Load -----
const exportBtn=document.getElementById('exportBtn');
const saveBtn=document.getElementById('saveBtn');
const loadBtn=document.getElementById('loadBtn');

exportBtn.addEventListener('click', ()=>{
  const blob=new Blob([codeOutput.textContent],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='AceBlocks.lua';
  a.click();
});

saveBtn.addEventListener('click', ()=>{ localStorage.setItem('aceblocksWorkspace',workspace.innerHTML); alert('Workspace saved!'); });
loadBtn.addEventListener('click', ()=>{
  const data=localStorage.getItem('aceblocksWorkspace');
  if(data){ workspace.innerHTML=data; updateCode(); alert('Workspace loaded!'); checkObjective(); }
});

// ----- Start lesson -----
const objectiveDiv=document.getElementById('objective');
const certificateDiv=document.getElementById('certificate');
const character=document.getElementById('character');

function startLesson(id){
  currentLesson=lessons.find(l=>l.id===id);
  objectiveDiv.textContent="Objective: "+currentLesson.objective;
  workspace.innerHTML='';
  // Show only lesson blocks
  document.querySelectorAll('.block').forEach(block=>{
    block.parentElement.style.display=currentLesson.blocks.includes(block.dataset.type)?'flex':'none';
  });
  certificateDiv.style.display='none';
  updateCode();
  character.textContent='ðŸ™‚';
}

// ----- Check if objective completed (simple simulation) -----
function checkObjective(){
  if(!currentLesson) return;
  const presentBlocks=Array.from(workspace.children).map(b=>b.dataset.type);
  const needed=currentLesson.blocks;
  const completed=needed.every(b=>presentBlocks.includes(b));
  character.textContent=completed?'ðŸ˜Ž':'ðŸ™‚';
  if(completed && currentLesson.id===12){
    certificateDiv.style.display='block';
  }
}

</script>
</body>
</html>
