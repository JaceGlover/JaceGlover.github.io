<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AceBlocks Sandbox</title>

<!-- Blockly -->
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/blockly_compressed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/blocks_compressed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/javascript_compressed.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #1e293b;
    color: white;
}

header {
    padding: 15px;
    background: #0f172a;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

#main {
    display: flex;
    height: calc(100vh - 60px);
}

#blocklyDiv {
    width: 70%;
    height: 100%;
    background: white;
}

#rightPanel {
    width: 30%;
    display: flex;
    flex-direction: column;
    background: #0f172a;
}

button {
    padding: 12px;
    background: #2563eb;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #1d4ed8;
}

#output {
    flex: 1;
    background: black;
    padding: 10px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 14px;
}
</style>
</head>

<body>

<header>AceBlocks JavaScript Sandbox</header>

<div id="main">
    <div id="blocklyDiv"></div>

    <div id="rightPanel">
        <button onclick="runCode()">â–¶ Run Code</button>
        <div id="output"></div>
    </div>
</div>

<!-- Toolbox -->
<xml id="toolbox" style="display:none">
    <category name="Logic" colour="210">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
    </category>

    <category name="Loops" colour="120">
        <block type="controls_repeat_ext"></block>
        <block type="controls_whileUntil"></block>
    </category>

    <category name="Math" colour="230">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
    </category>

    <category name="Text" colour="160">
        <block type="text"></block>
        <block type="text_print"></block>
    </category>

    <category name="Variables" custom="VARIABLE" colour="330"></category>
    <category name="Functions" custom="PROCEDURE" colour="290"></category>
</xml>

<script>
document.addEventListener("DOMContentLoaded", function () {

    window.workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        scrollbars: true,
        trashcan: true
    });

});

function runCode() {

    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";

    const code = Blockly.JavaScript.workspaceToCode(workspace);

    // Custom console.log override
    const customConsole = {
        log: function(message) {
            outputDiv.innerHTML += message + "<br>";
        }
    };

    try {
        new Function("console", code)(customConsole);
    } catch (error) {
        outputDiv.innerHTML += "<span style='color:red;'>Error: " + error.message + "</span>";
    }
}
</script>

</body>
</html>
