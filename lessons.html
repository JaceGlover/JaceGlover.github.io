<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AceBlocks Curriculum Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; font-family:Arial; background:#0f172a; color:white; }
header { background:#111827; padding:15px; text-align:center; }
.container { display:flex; height:calc(100vh - 70px); }
#panel { width:260px; background:#1e293b; padding:15px; border-right:3px solid #38bdf8; }
.block { background:linear-gradient(145deg,#334155,#1e293b); padding:10px; margin:8px 0; border-radius:10px; cursor:grab; font-weight:bold; }
.block:hover { background:linear-gradient(145deg,#475569,#334155); }
#workspace { flex:1; padding:20px; overflow:auto; }
.workspace-block { background:#1e293b; padding:10px; margin:8px 0; border-radius:10px; display:flex; justify-content:space-between; align-items:center; }
.delete { background:red; border:none; color:white; border-radius:50%; width:20px; height:20px; cursor:pointer; }
#objective { background:#1e293b; padding:10px; border-radius:8px; margin-bottom:15px; font-weight:bold; }
button { background:#38bdf8; border:none; padding:10px 15px; margin-top:10px; border-radius:6px; cursor:pointer; }
button:hover { background:#60a5fa; }
#output { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<header>
<h1>AceBlocks | NZ Curriculum Lua Course</h1>
</header>

<div class="container">
<div id="panel"></div>

<div id="workspace">
<div id="objective"></div>
<div id="blocksArea"></div>
</div>
</div>

<div style="text-align:center;padding:15px;">
<button onclick="runCode()">Run</button>
<button onclick="nextLesson()">Next Lesson</button>
<div id="output"></div>
</div>

<script>

// MASTER BLOCK LIBRARY
const blockLibrary = {
  WalkSpeed: { label:"Set WalkSpeed", code:"player.WalkSpeed = VALUE" },
  JumpPower: { label:"Set JumpPower", code:"player.JumpPower = VALUE" },
  PlayerAdded: { label:"On Player Join", code:"game.Players.PlayerAdded:Connect(function(player)\nend)" },
  ScreenGui: { label:"Create GUI", code:"local gui = Instance.new('ScreenGui', player.PlayerGui)" },
  TextLabel: { label:"Add TextLabel", code:"local textLabel = Instance.new('TextLabel', gui)" },
  Variable: { label:"Create Variable", code:"local VAR = VALUE" }
};

// LESSON STRUCTURE (NZ progression)
const lessons = [
{
  objective:"Make the player move faster.",
  availableBlocks:["WalkSpeed"],
  requiredBlocks:["WalkSpeed"]
},
{
  objective:"Make the player move faster AND jump higher.",
  availableBlocks:["WalkSpeed","JumpPower"],
  requiredBlocks:["WalkSpeed","JumpPower"]
},
{
  objective:"Create a GUI for the player.",
  availableBlocks:["ScreenGui"],
  requiredBlocks:["ScreenGui"]
},
{
  objective:"Create a GUI and add a TextLabel.",
  availableBlocks:["ScreenGui","TextLabel"],
  requiredBlocks:["ScreenGui","TextLabel"]
},
{
  objective:"Create a variable and use WalkSpeed.",
  availableBlocks:["Variable","WalkSpeed"],
  requiredBlocks:["Variable","WalkSpeed"]
},
{
  objective:"Welcome the player when they join.",
  availableBlocks:["PlayerAdded"],
  requiredBlocks:["PlayerAdded"]
}
];

let currentLesson = 0;

const panel = document.getElementById("panel");
const objective = document.getElementById("objective");
const blocksArea = document.getElementById("blocksArea");
const output = document.getElementById("output");

function loadLesson() {
  panel.innerHTML = "";
  blocksArea.innerHTML = "";
  output.textContent = "";

  const lesson = lessons[currentLesson];
  objective.textContent = "Lesson " + (currentLesson+1) + ": " + lesson.objective;

  lesson.availableBlocks.forEach(key => {
    const blockData = blockLibrary[key];
    const block = document.createElement("div");
    block.className = "block";
    block.textContent = blockData.label;
    block.draggable = true;
    block.dataset.key = key;

    block.addEventListener("dragstart", e=>{
      e.dataTransfer.setData("text/plain", key);
    });

    panel.appendChild(block);
  });
}

blocksArea.addEventListener("dragover", e=>e.preventDefault());

blocksArea.addEventListener("drop", e=>{
  e.preventDefault();
  const key = e.dataTransfer.getData("text/plain");
  const blockData = blockLibrary[key];

  const newBlock = document.createElement("div");
  newBlock.className = "workspace-block";
  newBlock.dataset.key = key;
  newBlock.innerHTML = `
    <span>${blockData.code.replace("VALUE","10").replace("VAR","myVar")}</span>
    <button class="delete">√ó</button>
  `;

  newBlock.querySelector(".delete").onclick = ()=>newBlock.remove();
  blocksArea.appendChild(newBlock);
});

function runCode() {
  const placedBlocks = [...blocksArea.querySelectorAll(".workspace-block")]
    .map(b => b.dataset.key);

  const required = lessons[currentLesson].requiredBlocks;

  const success = required.every(req => placedBlocks.includes(req));

  if(success){
    output.textContent = "‚úÖ Lesson Complete!";
  } else {
    output.textContent = "‚ùå You are missing required blocks.";
  }
}

function nextLesson() {
  if(currentLesson < lessons.length-1){
    currentLesson++;
    loadLesson();
  } else {
    objective.textContent = "üéâ Course Completed!";
    panel.innerHTML = "";
    blocksArea.innerHTML = "";
    output.textContent = "You finished all lessons!";
  }
}

loadLesson();

</script>
</body>
</html>
