<!DOCTYPE html>
<html>
<head>
<title>AceBlocks Lessons</title>
<script src="https://unpkg.com/blockly/blockly.min.js"></script>

<style>
body {
  font-family: Arial;
  margin: 0;
  background: #f4f6fa;
}

#lessonTitle {
  background: #1f73ff;
  color: white;
  padding: 15px;
  font-size: 20px;
}

#blocklyDiv {
  height: 400px;
  width: 100%;
}

#controls {
  padding: 15px;
}

button {
  padding: 10px 20px;
  background: #1f73ff;
  color: white;
  border: none;
  cursor: pointer;
  margin-right: 10px;
}

button:hover {
  background: #155edb;
}

#output {
  background: black;
  color: lime;
  padding: 10px;
  height: 100px;
  overflow: auto;
}

#certificateScreen {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  text-align: center;
  padding-top: 100px;
}

#certificateScreen h1 {
  font-size: 50px;
}

#certificateScreen p {
  font-size: 24px;
}
</style>
</head>

<body>

<div id="lessonTitle">Lesson 1: Print "Hello World"</div>

<div id="blocklyDiv"></div>

<div id="controls">
<button onclick="runCode()">Run</button>
<button onclick="nextLesson()">Next</button>
</div>

<div id="output"></div>

<div id="certificateScreen">
<h1>Certificate of Completion</h1>
<p id="certName"></p>
<p>Has successfully completed AceBlocks Coding Course</p>
<button onclick="window.print()">Print</button>
</div>

<xml id="toolbox" style="display:none">
  <block type="text_print"></block>
  <block type="text"></block>
  <block type="math_number"></block>
  <block type="math_arithmetic"></block>
</xml>

<script>

let currentLesson = 1;
let workspace = Blockly.inject('blocklyDiv',
  { toolbox: document.getElementById('toolbox') });

const lessons = {
1: {
title: 'Lesson 1: Print "Hello World"',
check: code => code.includes('Hello World')
},
2: {
title: 'Lesson 2: Print Your Name',
check: code => code.includes('Jace')
},
3: {
title: 'Lesson 3: Print a Number (5)',
check: code => code.includes('5')
},
4: {
title: 'Lesson 4: Add 2 + 3',
check: code => code.includes('2 + 3')
},
5: {
title: 'Lesson 5: Print Two Things',
check: code => code.split('print').length > 2
},
6: {
title: 'Lesson 6: Final Challenge - Print "I Love Coding"',
check: code => code.includes('I Love Coding')
}
};

function runCode() {
  let code = Blockly.JavaScript.workspaceToCode(workspace);
  document.getElementById('output').innerHTML = "";

  try {
    let output = "";
    const originalLog = console.log;
    console.log = function(text) {
      output += text + "<br>";
    };

    eval(code);

    console.log = originalLog;

    document.getElementById('output').innerHTML = output;

    if (lessons[currentLesson].check(code)) {
      alert("Lesson Complete! Click Next!");
    } else {
      alert("Not quite right! Try again.");
    }

  } catch (e) {
    alert("Error in code!");
  }
}

function nextLesson() {
  if (currentLesson < 6) {
    currentLesson++;
    workspace.clear();
    document.getElementById('lessonTitle').innerText =
      lessons[currentLesson].title;
  } else {
    generateCertificate();
  }
}

function generateCertificate() {
  let name = prompt("Enter your name for the certificate:");
  document.getElementById('certName').innerText = name;
  document.getElementById('certificateScreen').style.display = "block";
}

</script>

</body>
</html>
