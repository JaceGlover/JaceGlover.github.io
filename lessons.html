<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AceBlocks Lessons</title>

<!-- Stable Blockly -->
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/blockly_compressed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/blocks_compressed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/javascript_compressed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blockly@10.3.1/msg/en.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#111827;
  color:white;
  text-align:center;
}

header{
  background:#1f2937;
  padding:20px;
  font-size:24px;
  font-weight:bold;
}

#lessonTitle{
  margin-top:20px;
  font-size:22px;
}

#blocklyDiv{
  height:400px;
  width:90%;
  margin:20px auto;
  background:white;
  border-radius:10px;
}

button{
  padding:10px 20px;
  margin:10px;
  border:none;
  border-radius:6px;
  background:#3b82f6;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  background:#2563eb;
}

#output{
  margin-top:10px;
  font-weight:bold;
}

/* CERTIFICATE */

#certificate{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:white;
  color:black;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.cert-box{
  width:80%;
  max-width:900px;
  padding:60px;
  text-align:center;
  border:8px solid #3b82f6;
  border-radius:20px;
}

.cert-box h1{
  font-size:48px;
  margin-bottom:10px;
}

.sub{
  font-size:20px;
  margin-bottom:40px;
  color:#555;
}

.small{
  font-size:18px;
  margin:15px 0;
}

#certName{
  font-size:42px;
  margin:20px 0;
  color:#3b82f6;
}

.signature-area{
  display:flex;
  justify-content:space-between;
  margin-top:60px;
}

.signature{
  font-family:cursive;
  font-size:28px;
  margin-bottom:5px;
}

hr{
  width:200px;
}

#printBtn{
  margin-top:40px;
  padding:12px 24px;
  background:black;
  color:white;
  border:none;
  cursor:pointer;
}

@media print{
  body *{
    visibility:hidden;
  }
  #certificate, #certificate *{
    visibility:visible;
  }
  #certificate{
    position:absolute;
    left:0;
    top:0;
  }
  #printBtn{
    display:none;
  }
}
</style>
</head>

<body>

<header>AceBlocks Lessons</header>

<div id="lessonTitle"></div>

<div id="blocklyDiv"></div>

<button id="runBtn">Run Code</button>

<div id="output"></div>

<!-- CERTIFICATE -->
<div id="certificate">
  <div class="cert-box">
    <h1>Certificate of Completion</h1>
    <p class="sub">AceBlocks Visual Coding Program</p>

    <p class="small">This certifies that</p>
    <h2 id="certName"></h2>

    <p class="small">
      has successfully completed all six AceBlocks coding lessons
      and demonstrated understanding of block-based scripting.
    </p>

    <div class="signature-area">
      <div>
        <p class="signature">Jace Glover</p>
        <hr>
        <p class="small">Founder, AceBlocks</p>
      </div>

      <div>
        <p id="certDate"></p>
        <hr>
        <p class="small">Date</p>
      </div>
    </div>

    <button id="printBtn" onclick="window.print()">Print Certificate</button>
  </div>
</div>

<!-- TOOLBOX -->
<xml id="toolbox" style="display:none">
  <block type="text_print"></block>
  <block type="text"></block>
  <block type="math_number"></block>
  <block type="math_arithmetic"></block>
</xml>

<script>

// WORKSPACE
const workspace = Blockly.inject('blocklyDiv',{
  toolbox:document.getElementById('toolbox')
});

// Custom print generator
Blockly.JavaScript['text_print'] = function(block){
  const msg = Blockly.JavaScript.valueToCode(block,'TEXT',Blockly.JavaScript.ORDER_NONE) || '""';
  return 'console.log('+msg+');\n';
};

let currentLesson = 1;

// HELPERS
function hasPrintWithValue(){
  const blocks = workspace.getAllBlocks(false);
  for(let block of blocks){
    if(block.type==="text_print"){
      if(block.getInputTargetBlock("TEXT")){
        return true;
      }
    }
  }
  return false;
}

function countValidPrints(){
  const blocks = workspace.getAllBlocks(false);
  let count=0;
  for(let block of blocks){
    if(block.type==="text_print"){
      if(block.getInputTargetBlock("TEXT")){
        count++;
      }
    }
  }
  return count;
}

// LESSONS
const lessons={
1:{
  title:'Lesson 1: Print "Hello World"',
  check:()=>{
    const code=Blockly.JavaScript.workspaceToCode(workspace);
    return code.includes("Hello World");
  }
},
2:{
  title:'Lesson 2: Print Anything (Not Blank)',
  check:()=>{
    return hasPrintWithValue();
  }
},
3:{
  title:'Lesson 3: Print the Number 5',
  check:()=>{
    const code=Blockly.JavaScript.workspaceToCode(workspace);
    return code.includes("5");
  }
},
4:{
  title:'Lesson 4: Add 2 + 3',
  check:()=>{
    const code=Blockly.JavaScript.workspaceToCode(workspace);
    return code.includes("2 + 3");
  }
},
5:{
  title:'Lesson 5: Print Two Things',
  check:()=>{
    return countValidPrints()>=2;
  }
},
6:{
  title:'Lesson 6: Print "I Love Coding"',
  check:()=>{
    const code=Blockly.JavaScript.workspaceToCode(workspace);
    return code.includes("I Love Coding");
  }
}
};

// LOAD LESSON
function loadLesson(){
  workspace.clear();
  document.getElementById('lessonTitle').innerText=lessons[currentLesson].title;
  document.getElementById('output').innerText='';
}

// RUN BUTTON
document.getElementById('runBtn').addEventListener('click',function(){

  if(lessons[currentLesson].check()){
    document.getElementById('output').style.color="#10b981";
    document.getElementById('output').innerText="Correct!";
    currentLesson++;

    if(currentLesson>6){
      showCertificate();
    }else{
      setTimeout(loadLesson,800);
    }

  }else{
    document.getElementById('output').style.color="#ef4444";
    document.getElementById('output').innerText="Not correct. Try again.";
  }
});

// CERTIFICATE
function showCertificate(){
  document.getElementById('certificate').style.display='flex';

  let name=prompt("Enter your name for the certificate:");
  document.getElementById('certName').innerText=name||"Student";

  const today=new Date();
  document.getElementById('certDate').innerText=today.toLocaleDateString();
}

loadLesson();

</script>

</body>
</html>
